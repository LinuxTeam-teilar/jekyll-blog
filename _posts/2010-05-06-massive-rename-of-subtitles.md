---
layout: post
title: Massive rename of subtitles
created: 1273134183
categories:
- !ruby/string:Sequel::SQL::Blob bash
- !ruby/string:Sequel::SQL::Blob script
---
<p style="text-align: justify">Χρειάστηκα προ λίγων ημερών ένα script για να κάνω μαζική μετονομασία αρχείων βάσει άλλων αρχείων. Πιο συγκεκριμένα, ήθελα να μετονομάσω τα αρχεία των υποτίτλων μιας σειράς (πολλές σεζόν) βάσει των ονομάτων των αρχείων video ώστε να τους βρίσκει και να τους φορτώνει αυτόματα το πρόγραμμα αναπαραγωγής. Τελικά κατέληξα στο παρακάτω script :</p><blockquote>#!/bin/sh<br><br>echo "Creating lists..."<br>ls -1 .. | grep avi &gt; avi<br>ls -1 *.srt &gt; srt<br><br>count=`wc -l avi | sed 's/avi//'`<br>echo "$count files"<br><br>echo "Renaming srt files..."<br>for i in `seq 1 $count`<br>do<br>&nbsp; &nbsp;from=`cat srt | head -n $i | tail -n 1`<br>&nbsp; &nbsp;to=`cat avi | head -n $i | tail -n 1 | sed 's/avi/srt/'`<br>&nbsp; &nbsp;echo "Renaming $from -to- $to"<br>&nbsp; &nbsp;mv "$from" "$to"<br>done</blockquote><p style="text-align: justify"><br>Επεξήγηση :<!--break--><br>Αρχικά δημιουργούνται δυο αρχεία-λίστες που περιέχουν τα ονόματα των αρχείων των video και των υποτίτλων ταξινομημένα. Δηλαδή η πρώτη γραμμή της λίστας με τα video (avi) θα αντιστοιχεί στην πρώτη γραμμή της λίστας με τους υπότιτλους. Τα αρχεία των υποτίτλων βρίσκονται σε υποφάκελο αυτού με τα video. Για την εύρεση των αρχείων video χρησιμοποιήθηκε επιπλέον η εντολή grep καθώς μπορεί να μην είχε ολοκληρωθεί το κατέβασμα κάποιων αρχείων και να είχαν επέκταση .avi.part αντί για σκέτο .avi.</p><p style="text-align: justify">Στη συνέχεια μετράται το πλήθος των γραμμών του αρχείου avi και περνάει από μια εντολή sed ώστε να αντικατασταθεί η λέξη "avi" με το κενό. Θα μπορούσε να γίνει το ίδιο και με τη λίστα των υποτίτλων και στη συνέχεια να συγκριθούν τα δυο αρχεία ώστε να προβλέψουμε τυχόν σφάλμα.</p><p style="text-align: justify">Τέλος, υπάρχει μια επανάληψη για όλες τις γραμμές των αρχείων μέσα στην οποία ορίζονται οι μεταβλητές from και to που θα χρησιμοποιηθούν στη μετονομασία. Αυτό γίνεται με χρήση της εντολής cat που εκτυπώνει το αρχείο, περνώντας της το output στην εντολή head -n i ώστε να εκτυπώσει τις i πρώτες γραμμές και τέλος περνώντας το output της εντολής head στην εντολή tail -n 1 η οποία θα εκτυπώσει την τελευταία γραμμή από αυτές που θα δεχτεί σαν είσοδο. Δηλαδή για i = 3 η μεταβλητή from θα περιέχει μόνο την 3η γραμμή του αρχείου. Με παρόμοιο τρόπο ορίζεται η μεταβλητή to και ακολουθεί η εκτύπωση της διαδικασίας στην οθόνη και η μετονομασία των αρχείων.</p>
